
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="htwg-bubble">

  <style>
    * {
        box-sizing: border-box;
    }
    .row::after {
        content: "";
        clear: both;
        display: block;
    }
    [class*="col-"] {
        float: left;
    }

    .col-1 {width: 10%;
            height: 0;
			padding-top: 10%;
			display: block;
    }
    .col-2 {width: 20%;}
    .col-3 {width: 30%;}
    .col-4 {width: 40%;}
    .col-5 {width: 50%;}
    .col-6 {width: 60%;}
    .col-7 {width: 70%;}
    .col-8 {width: 80%;}
    .col-9 {width: 90%;}
    .col-10 {width: 100%;}

    .showBorder{
      border: solid;
    }
	
	#bubbles,
    .bubble-container,
    .bubble {
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

	#bubbles,
	.bubble {
		overflow: hidden;
	}

	.bubble-container,
	.bubble {
		border-radius: 25%;
	}

	.bubbleContainer {
		width: 383.35px;
        height: 383.35px;
		
		position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
		background: cyan;
	}
	
	.bubble {
		background: cyan;
	}

	.full {
		left: -30%;
		top: -30%;
		width: 160%;
		height: 160%;
	}
	.noCorners {

	}
	.topRight {
		left: -30%;
		width: 130%;
		height: 130%;
	}
	.bottomRight {
		left: -30%;
		top: -30%;
		width: 130%;
		height: 130%;
	}
	.bottomLeft {
		top: -30%;
		width: 130%;
		height: 130%;
	}
	.topLeft {
		width: 130%;
		height: 130%;
	}
	.top {
		height: 130%;
	}
	.right {
		left: -30%;
		width: 130%;
	}
	.bottom {
		top: -30%;
		height: 130%;
	}
	.left {
		width: 130%;
	}
	.empty {
		background: white;
	}
	
  </style>

  <template>
      <div class="col-1" style="position: relative;">
        <content id="myContent">{{text}}</content>
		<div id="bubbles">
		  <div class="bubble-container">
		    <div class="bubble">
		    </div>
		  </div>
		</div>
      </div>
  </template>

</dom-module>

<script>
  Polymer({
    is: 'htwg-bubble',

    properties: {
	  inactiveStates: {
		type: Array,
		value: ["full", "noCorners", "topRight", "bottomRight", "bottomLeft", "topLeft", "top", "right", "bottom", "left"]
	  },
	  activeStates: {
		type: Array,
		value: ["empty", "topRight", "bottomRight", "bottomLeft", "topLeft", "top", "right", "bottom", "left", "notTopRight",
				"notBottomRight", "notBottomLeft", "notTopLeft", "diagonalRight", "diagonalLeft", "lonesome"]
	  },
	  currentState: String,
      textColor: {
        type: String,
        value: "black"
      },
      active: {
        type: Boolean,
        value: false,
		reflectToAttribute: true,
		notify: true,
		observer: "_activeChanged"
      },
      backgroundColor: {
        type: String,
        value: "blue"
      },
      neighbors:{
        type: Array,
		value: function() {return [];} //otherwise it's shared (https://github.com/Polymer/polymer/issues/3505)
      },
      text: {
        type:String,
        value: "."
      },
	  x: Number,
	  y: Number,
    },
    attached: function(){
      if(this.active){
        this.text = "bla";//this.text;
      }
	  this.setNeighbors()
	  this.checkNeighbors()
    },

	_activeChanged: function() {
		console.log(this.active);
		if(this.neighbors != undefined) {
			this.checkNeighbors();
			
			for(neighbor of this.neighbors) {
				if(neighbor != null) {
					console.log("tuk");
					neighbor.checkNeighbors();
				}
			}

		}
	},

	setNeighbors: function() {
		var frame = document.getElementsByTagName("htwg-bubble-frame")[0];
		this.neighbors[0] = frame.$$('#x' +  this.x      + 'y' + (this.y - 1));
		this.neighbors[1] = frame.$$('#x' + (this.x + 1) + 'y' + (this.y -1));
		this.neighbors[2] = frame.$$('#x' + (this.x + 1) + 'y' +  this.y);
		this.neighbors[3] = frame.$$('#x' + (this.x + 1) + 'y' + (this.y + 1));
		this.neighbors[4] = frame.$$('#x' +  this.x      + 'y' + (this.y + 1));
		this.neighbors[5] = frame.$$('#x' + (this.x - 1) + 'y' + (this.y + 1));
		this.neighbors[6] = frame.$$('#x' + (this.x - 1) + 'y' +  this.y);
		this.neighbors[7] = frame.$$('#x' + (this.x - 1) + 'y' + (this.y - 1));
	},

	checkNeighbors: function() {
		//console.log(this.x + " " + this.y + ": ");
		this.$$('.bubble').classList.remove(this.currentState);
		console.log(this.neighbors);
		var check = [];
		for(i = 0; i < 8; i++) {
			var active;
			if(this.neighbors[i] == null) {
				active = false;
			} else {
				active = this.neighbors[i].active;
			}
			check[i] = active;
			//console.log(active);
		}
		if(this.active) {
			this.currentState = this.activeStates[0];
		} else {
			if((!check[0] && !check[4]) || (!check[2] && !check[6])) {
				this.currentState = this.inactiveStates[0];
			} else if(check[0] && check[2] && check[4] && check[6]) {
				this.currentState = this.inactiveStates[1];
			} else if(!check[4] && !check[6]) {
				this.currentState = this.inactiveStates[2];
			} else if(!check[6] && !check[0]) {
				this.currentState = this.inactiveStates[3];
			} else if(!check[0] && !check[2]) {
				this.currentState = this.inactiveStates[4];
			} else if(!check[2] && !check[4]) {
				this.currentState = this.inactiveStates[5];
			} else if(!check[4]) {
				this.currentState = this.inactiveStates[6];
			} else if(!check[6]) {
				this.currentState = this.inactiveStates[7];
			} else if(!check[0]) {
				this.currentState = this.inactiveStates[8];
			} else if(!check[2]) {
				this.currentState = this.inactiveStates[9];
			}
		}
		//this.bubble = document.createElement('div');
        //this.bubbleContainer = document.createElement('div');
		//Polymer.dom(this.bubbleContainer.parentNode).removeChild(
        //  this.bubbleContainer
        //);
        //this.bubble.style.backgroundColor = this.color;
        //this.bubble.classList.add('bubble');
		//this.bubble.classList.add(this.currentState);
        //this.bubbleContainer.classList.add('bubble-container');
        //Polymer.dom(this.bubbleContainer).appendChild(this.bubble);
		
		//Polymer.dom(this.$.bubbles).appendChild(this.bubbleContainer);
		this.$$('.bubble').classList.add(this.currentState);
		console.log(this.currentState);
	}
  });
</script>