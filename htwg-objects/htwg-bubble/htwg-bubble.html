
<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="htwg-bubble">

  <style>
    * {
        box-sizing: border-box;
    }
    .row::after {
        content: "";
        clear: both;
        display: block;
    }
    [class*="col-"] {
        float: left;
    }

    .col-1 {width: 10%;
            height: 0;
			padding-top: 10%;
			display: block;
    }
    .col-2 {width: 20%;}
    .col-3 {width: 30%;}
    .col-4 {width: 40%;}
    .col-5 {width: 50%;}
    .col-6 {width: 60%;}
    .col-7 {width: 70%;}
    .col-8 {width: 80%;}
    .col-9 {width: 90%;}
    .col-10 {width: 100%;}

    .showBorder{
      border: solid;
    }
	
	#bubbles,
    .bubble-container,
    .bubble {
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

	#bubbles,
	.bubble {
		overflow: hidden;
	}
	
	:host([active]) .bubble-container,
	.bubble {
		background: cyan;
	}

	.bubble-container,
	:host([active]) .bubble {
		background: white;
	}

	.full {

	}
	.noCorners {
		border-radius: var(--bubble-border-radius, 25%);
	}
	.topRight {
		border-top-right-radius: var(--bubble-border-radius, 25%);
	}
	.bottomRight {
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
	}
	.bottomLeft {
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
	}
	.topLeft {
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.top {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.right {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
	}
	.bottom {
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
	}
	.left {
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	
	:host([active]) .empty {
		
	}
	:host([active]) .topRight {
		border-top-right-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .bottomRight {
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .bottomLeft {
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .topLeft {
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .top {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .right {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .bottom {
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
	}
	:host([active]) .left {
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.notTopRight {
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.notBottomRight {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.notBottomLeft {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.notTopLeft {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
	}
	.diagonalRight {
		border-bottom-right-radius: var(--bubble-border-radius, 25%);
		border-top-left-radius: var(--bubble-border-radius, 25%);
	}
	.diagonalLeft {
		border-top-right-radius: var(--bubble-border-radius, 25%);
		border-bottom-left-radius: var(--bubble-border-radius, 25%);
	}
	.lonesome {
		border-radius: var(--bubble-border-radius, 25%);
	}
	
  </style>

  <template>
      <div class="col-1" style="position: relative;">
        <content id="myContent">{{text}}</content>
		<div id="bubbles">
		  <div class="bubble-container">
		    <div class="bubble">
		    </div>
		  </div>
		</div>
      </div>
  </template>

</dom-module>

<script>
  Polymer({
    is: 'htwg-bubble',

    properties: {
	  inactiveStates: {
		type: Array,
		value: ["full", "noCorners", "topRight", "bottomRight", "bottomLeft", "topLeft", "top", "right", "bottom", "left"]
	  },
	  activeStates: {
		type: Array,
		value: ["empty", "topRightActive", "bottomRight", "bottomLeft", "topLeft", "top", "right", "bottom", "left", "notTopRight",
				"notBottomRight", "notBottomLeft", "notTopLeft", "diagonalRight", "diagonalLeft", "lonesome"]
	  },
	  currentState: String,
      textColor: {
        type: String,
        value: "black"
      },
      active: {
        type: Boolean,
        value: false,
		reflectToAttribute: true,
		notify: true,
		observer: "_activeChanged"
      },
      backgroundColor: {
        type: String,
        value: "blue"
      },
      neighbors:{
        type: Array,
		value: function() {return [];} //otherwise it's shared (https://github.com/Polymer/polymer/issues/3505)
      },
      text: {
        type:String,
        value: "."
      },
	  x: Number,
	  y: Number,
    },
    attached: function(){
	  this.setNeighbors()
	  this.checkNeighbors()
	  for(neighbor of this.neighbors) {
			if(neighbor != null) {
				neighbor.setNeighbors();
				neighbor.checkNeighbors();
			}
		}
    },

	_activeChanged: function() {
		if(this.neighbors != undefined) {
			this.checkNeighbors();
			for(neighbor of this.neighbors) {
				if(neighbor != null) {
					neighbor.checkNeighbors();
				}
			}
		}
	},

	setNeighbors: function() {
		var frame = document.getElementsByTagName("htwg-bubble-frame")[0];
		this.neighbors[0] = frame.$$('#x' +  this.x      + 'y' + (this.y - 1));
		this.neighbors[1] = frame.$$('#x' + (this.x + 1) + 'y' + (this.y -1));
		this.neighbors[2] = frame.$$('#x' + (this.x + 1) + 'y' +  this.y);
		this.neighbors[3] = frame.$$('#x' + (this.x + 1) + 'y' + (this.y + 1));
		this.neighbors[4] = frame.$$('#x' +  this.x      + 'y' + (this.y + 1));
		this.neighbors[5] = frame.$$('#x' + (this.x - 1) + 'y' + (this.y + 1));
		this.neighbors[6] = frame.$$('#x' + (this.x - 1) + 'y' +  this.y);
		this.neighbors[7] = frame.$$('#x' + (this.x - 1) + 'y' + (this.y - 1));
	},

	checkNeighbors: function() {
		this.$$('.bubble').classList.remove(this.currentState);
		var check = [];
		for(i = 0; i < 8; i++) {
			var active;
			if(this.neighbors[i] == null) {
				active = false;
			} else {
				active = this.neighbors[i].active;
			}
			check[i] = active;
		}
		if(this.active) {
			if(!check[0] && !check[1] && !check[2] && !check[3] && !check[4] && !check[5] && !check[6] && !check[7]) {
				this.currentState = this.activeStates[15];
			} else if(!check[0] && !check[2] && !check[3] && !check[4] && !check[5] && !check[6] && !check[7]) {//notTopRight
				this.currentState = this.activeStates[9];
			} else if(!check[0] && !check[1] && !check[2] && !check[4] && !check[5] && !check[6] && !check[7]) {//notBottomRight
				this.currentState = this.activeStates[10];
			} else if(!check[0] && !check[1] && !check[2] && !check[3] && !check[4] && !check[6] && !check[7]) {//notBottomLeft
				this.currentState = this.activeStates[11];
			} else if(!check[0] && !check[1] && !check[2] && !check[3] && !check[4] && !check[5] && !check[6]) {//notTopLeft
				this.currentState = this.activeStates[12];
			} else if(!check[0] && !check[2] && !check[3] && !check[4] && !check[6] && !check[7]) {//diagonalRight
				this.currentState = this.activeStates[13];
			} else if(!check[0] && !check[1] && !check[2] && !check[4] && !check[5] && !check[6]) {//diagonalLeft
				this.currentState = this.activeStates[14];
			} else if(!check[6] && !check[7] && !check[0] && !check[1] && !check[2]) {//top
				this.currentState = this.activeStates[5];
			} else if(!check[0] && !check[1] && !check[2] && !check[3] && !check[4]) {//right
				this.currentState = this.activeStates[6];
			} else if(!check[2] && !check[3] && !check[4] && !check[5] && !check[6]) {//bottom
				this.currentState = this.activeStates[7];
			} else if(!check[4] && !check[5] && !check[6] && !check[7] && !check[0]) {//left
				this.currentState = this.activeStates[8];
			} else if(!check[0] && !check[1] && !check[2]) {//topRight
				this.currentState = this.activeStates[1];
			} else if(!check[2] && !check[3] && !check[4]) {//bottomRight
				this.currentState = this.activeStates[2];
			} else if(!check[4] && !check[5] && !check[6]) {//bottomLeft
				this.currentState = this.activeStates[3];
			} else if(!check[6] && !check[7] && !check[0]) {//topLeft
				this.currentState = this.activeStates[4];
			} else {//empty
				this.currentState = this.activeStates[0];
			}
		} else {
			if((!check[0] && !check[4]) || (!check[2] && !check[6])) {
				this.currentState = this.inactiveStates[0];
			} else if(check[0] && check[2] && check[4] && check[6]) {
				this.currentState = this.inactiveStates[1];
			} else if(!check[4] && !check[6]) {
				this.currentState = this.inactiveStates[2];
			} else if(!check[6] && !check[0]) {
				this.currentState = this.inactiveStates[3];
			} else if(!check[0] && !check[2]) {
				this.currentState = this.inactiveStates[4];
			} else if(!check[2] && !check[4]) {
				this.currentState = this.inactiveStates[5];
			} else if(!check[4]) {
				this.currentState = this.inactiveStates[6];
			} else if(!check[6]) {
				this.currentState = this.inactiveStates[7];
			} else if(!check[0]) {
				this.currentState = this.inactiveStates[8];
			} else if(!check[2]) {
				this.currentState = this.inactiveStates[9];
			}
		}
		this.$$('.bubble').classList.add(this.currentState);
	}
  });
</script>